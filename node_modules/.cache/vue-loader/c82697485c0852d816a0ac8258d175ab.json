{"remainingRequest":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangyufan/em/testPro/vue-scale/src/components/cascader/Cascader.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/zhangyufan/em/testPro/vue-scale/src/components/cascader/Cascader.vue","mtime":1573474128000},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/css-loader/index.js","mtime":1573721989187},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1574242648574},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/postcss-loader/src/index.js","mtime":1573721998387},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/sass-loader/lib/loader.js","mtime":1574242652692},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/cache-loader/dist/cjs.js","mtime":1573721989004},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js","mtime":1574242648574}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import \"cascader.scss\";\n",{"version":3,"sources":["Cascader.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgeA","file":"Cascader.vue","sourceRoot":"src/components/cascader","sourcesContent":["<template>\r\n  <div\r\n    class=\"w-cascader-wrap\"\r\n    :class=\"{\r\n      ['w-cascader-active']: !!realValue.length || searchKeyWord,\r\n      ['w-cascader-wrapdisabled']: disabledValue,\r\n    }\"\r\n    @click=\"cascaderClick($event)\"\r\n    ref=\"cascader\"\r\n    v-doc-click=\"bodyClick\"\r\n  >\r\n    <slot v-if=\"$slots.default\"></slot>\r\n    <div\r\n      class=\"w-cascader\"\r\n      :class=\"{\r\n        ['w-cascader-disabled']: disabledValue,\r\n      }\"\r\n      v-else\r\n    >\r\n      <div\r\n        class=\"w-cascader-result\"\r\n        v-if=\"(\r\n          !search && realValue.length\r\n        )\"\r\n        :class=\"{\r\n          [`w-cascader-result-${this.size}`]: this.size,\r\n          ['w-cascader-result-disabled']: disabledValue,\r\n        }\"\r\n      >\r\n        <w-cascader-render\r\n          :render=\"displayRender\"\r\n          :realValue=\"realValue\"\r\n          :chooseAllItem=\"chooseAllItem\"\r\n          :chooseValue=\"chooseValue\"\r\n          :chooseResult=\"chooseResult.slice()\"\r\n          :options=\"options\"\r\n          :currentOption=\"currentOption\"\r\n          v-if=\"displayRender\"\r\n        ></w-cascader-render>\r\n        <template v-else>\r\n          {{chooseValue.join(' / ')}}\r\n        </template>\r\n      </div>\r\n      <input\r\n        class=\"w-cascader-input\"\r\n        :class=\"{\r\n          [`w-cascader-input-${this.size}`]: this.size,\r\n          ['w-cascader-input-active']:\r\n            (realValue.length)\r\n            && !optStatus,\r\n          ['w-cascader-input-disabled']: disabledValue,\r\n        }\"\r\n        type=\"text\"\r\n        ref=\"input\"\r\n        :readonly=\"!search\"\r\n        v-else\r\n        autocomplete=\"off\"\r\n        aria-label=\"input\"\r\n        :placeholder=\"\r\n          (chooseValue.join(' / '))\r\n          || placeholder\r\n        \"\r\n        v-model=\"searchKeyWord\"\r\n        @keyup.enter=\"searchEnter($event)\"\r\n        @keyup.down=\"searchKeyDown\"\r\n        @keyup.up=\"searchKeyUp\"\r\n      >\r\n      <i :class=\"{\r\n        ['w-cascader-loading']: loading,\r\n        ['w-cascader-arrow']: !loading,\r\n        ['w-cascader-arrow-active']: !loading && optStatus,\r\n      }\"></i>\r\n      <i class=\"w-cascader-remove\" :class=\"{\r\n        ['w-cascader-remove-active']: (!!realValue.length && !loading) || searchKeyWord,\r\n      }\" @click=\"clear($event)\"></i>\r\n    </div>\r\n    <div\r\n      class=\"w-cascader-option\"\r\n      v-transfer-dom=\"getContainer && getContainer()\"\r\n      :data-transfer=\"transfer\"\r\n      :class=\"optionClass\"\r\n      ref=\"popElem\"\r\n    >\r\n      <w-cascader-search\r\n        :search=\"searchData\"\r\n        :getSearchResult=\"getSearchResult\"\r\n        :emptyText=\"emptyText\"\r\n        :width=\"searchWidth\"\r\n        :searchKeyWord=\"searchKeyWord\"\r\n        :sreachChange=\"searchChange\"\r\n        :hoverIndex=\"searchHoverIndex\"\r\n        :searchRender=\"searchRender\"\r\n        v-if=\"searchKeyWord\"\r\n      ></w-cascader-search>\r\n      <w-cascader-panel\r\n        :option=\"options\"\r\n        @panelChange=\"panelChange\"\r\n        v-model=\"realValue\"\r\n        :oldValue=\"defValue.slice()\"\r\n        :fieldNames=\"fieldNames\"\r\n        v-else\r\n      ></w-cascader-panel>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport {\r\n  Component,\r\n  Model,\r\n  Prop,\r\n  Emit,\r\n  Vue,\r\n} from 'vue-property-decorator';\r\nimport { mixins } from 'vue-class-component';\r\nimport addDOMEventListener from 'add-dom-event-listener';\r\nimport TransferDom from '@/directives/transfer-dom';\r\nimport docClick from '@/directives/doclick';\r\nimport { hasOwn } from '@/helper/o';\r\nimport { findEnabled } from '@/helper/option';\r\nimport { noop } from '@/helper/noop';\r\nimport {\r\n  OptionsEntity,\r\n  FieldNamesEntity,\r\n  ReturnParamsEntity,\r\n  fieldNamesDefault,\r\n} from './entity';\r\nimport {\r\n  setPostion,\r\n} from '@/helper/poper';\r\nimport poperMixin from '@/helper/popermixin';\r\nimport WCascaderPanel from './CascaderPanel.vue';\r\nimport WCascaderRender from './cascader-render';\r\nimport WCascaderSearch from './cascader-search';\r\nimport { objToPath, getValueByLabel } from './helper';\r\n\r\nVue.directive('transfer-dom', (TransferDom as any));\r\n\r\nVue.directive('doc-click', (docClick as any));\r\n\r\n@Component({\r\n  components: {\r\n    WCascaderPanel,\r\n    WCascaderRender,\r\n    WCascaderSearch,\r\n  },\r\n})\r\nexport default class Cascader extends mixins(poperMixin) {\r\n  optStatus: boolean = false;\r\n\r\n  searchKeyWord: string = '';\r\n\r\n  searchHoverIndex: number = -1;\r\n\r\n  searchResult: any[] = [];\r\n\r\n  // 如果没指定 v-model ，就存到这里，以便使用数组引用进行更新\r\n  // 解决不传 v-model ， 点击选中三级 ， 再显示，不选再关上，删除之后的问题\r\n  defValue: string[] = [];\r\n\r\n  chooseResult: any[] = []; // 点击下拉选项，最后一级之后所得到的值\r\n\r\n  chooseAllItem: any[] = []; // 点击下拉选项每一级选择的数据\r\n\r\n  chooseItemResult: any[] = []; // 点击下拉选项每一级选择的数据\r\n\r\n  currentOption: any = {};\r\n\r\n  resizeEvent: any = null;\r\n\r\n  @Model('model', { type: Array }) readonly value!: string[];\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noop,\r\n  }) private options!: any[];\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: '未匹配到结果',\r\n  }) private emptyText!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: '',\r\n  }) private searchWidth!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: '请选择',\r\n  }) private placeholder!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: 'bottomLeft',\r\n  }) private placement!: string;\r\n\r\n  @Prop(String) private size!: string;\r\n\r\n  @Prop(Boolean) private loading!: boolean;\r\n\r\n  @Prop(Boolean) private disabled!: boolean;\r\n\r\n  @Prop(Boolean) private search!: boolean;\r\n\r\n  @Prop({\r\n    type: Boolean,\r\n    default: true,\r\n  }) private transfer!: boolean;\r\n\r\n  @Prop({\r\n    type: Number,\r\n    default: 4,\r\n  }) private interval!: number;\r\n\r\n  @Prop({\r\n    type: Object,\r\n    default: (): FieldNamesEntity => fieldNamesDefault,\r\n  }) private fieldNames!: FieldNamesEntity;\r\n\r\n  @Prop({\r\n    type: Function,\r\n    default() {\r\n      return new Promise((resolve) => {\r\n        (this as any).$nextTick(() => {\r\n          resolve();\r\n        });\r\n      });\r\n    },\r\n  }) private before!: Function;\r\n\r\n  @Prop(Function) private getContainer!: Function;\r\n\r\n  @Prop(Function) private searchRender!: Function;\r\n\r\n  @Prop(Function) private displayRender!: Function;\r\n\r\n  @Prop({\r\n    type: Function,\r\n    default: noop,\r\n  }) private change!: Function;\r\n\r\n  @Prop({\r\n    type: Function,\r\n    default: noop,\r\n  }) private click!: Function;\r\n\r\n  get searchData() {\r\n    return objToPath(this.options.slice(), this.fieldNames).slice();\r\n  }\r\n\r\n  get hasValue() {\r\n    return !!this.value;\r\n  }\r\n\r\n  get chooseValue() {\r\n    return getValueByLabel(this.realValue, this.options, this.fieldNames).slice();\r\n  }\r\n\r\n  get realValue() {\r\n    const value = this.hasValue ? this.value : this.defValue;\r\n    return value.slice();\r\n  }\r\n\r\n  get disabledValue() {\r\n    return this.disabled;\r\n  }\r\n\r\n  get optionClass() {\r\n    return {\r\n      'w-cascader-option-show': this.optStatus,\r\n    };\r\n  }\r\n\r\n  mounted() {\r\n    this.defValue = this.realValue.slice();\r\n    this.resizeEvent = addDOMEventListener(window, 'resize', this.resizeChange);\r\n  }\r\n\r\n  beforeDestroy() {\r\n    this.resizeEvent.remove();\r\n  }\r\n\r\n  resizeChange() {\r\n    setPostion(this, 'cascader');\r\n  }\r\n\r\n  updateValue(value: string[]) {\r\n    if (this.hasValue) {\r\n      this.$emit('model', value);\r\n    } else {\r\n      this.defValue = value;\r\n    }\r\n  }\r\n\r\n  @Emit('change')\r\n  panelChange(params: ReturnParamsEntity, ev: MouseEvent) {\r\n    const {\r\n      current, item, index, floor,\r\n    } = params;\r\n    const value = params[this.fieldNames.value];\r\n    const children = params[this.fieldNames.children];\r\n    this.currentOption = {\r\n      [this.fieldNames.value]: value,\r\n      current,\r\n      index,\r\n      floor,\r\n      [this.fieldNames.children]: children,\r\n      ev,\r\n      item,\r\n      options: this.options,\r\n    };\r\n\r\n    this.chooseAllItem.push(item);\r\n\r\n    this.updateValue(value);\r\n    this.change(this.currentOption, ev);\r\n    // 如果到最后一个选项了就更新显示，在不及时显示选项的模式( changeOnSelect )下\r\n    if (!children.length) {\r\n      this.chooseItemResult = this.chooseAllItem.slice();\r\n      this.chooseResult = value.slice();\r\n    }\r\n\r\n    return this.currentOption;\r\n  }\r\n\r\n  cascaderClick(ev: MouseEvent) {\r\n    if (!this.disabledValue && !this.loading) {\r\n      this.before().then(() => {\r\n        this.setStatus(true);\r\n        this.$nextTick(() => {\r\n          setPostion(this, 'cascader');\r\n          if (this.search) {\r\n            this.searchFocus();\r\n          }\r\n          this.$emit('click', ev);\r\n          this.click(ev);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  bodyClick() {\r\n    if (this.optStatus) {\r\n      this.setStatus(false);\r\n      this.reset();\r\n      this.searchReset();\r\n    }\r\n  }\r\n\r\n  // 清除当前选中的所有\r\n  popValue() {\r\n    const value = this.hasValue ? this.value : this.defValue;\r\n    // 清除所有\r\n    while (value.length) {\r\n      value.pop();\r\n    }\r\n    return value;\r\n  }\r\n\r\n  reset() {\r\n    if (\r\n      hasOwn(this.currentOption, this.fieldNames.children)\r\n      && this.currentOption[this.fieldNames.children].length\r\n    ) {\r\n      const value = this.popValue();\r\n      const oldValue = this.chooseResult.length > 0 ? this.chooseResult : this.defValue;\r\n      // // 恢复之前设置的\r\n      oldValue.forEach((res) => {\r\n        value.push(res);\r\n      });\r\n      this.updateValue(value);\r\n      this.chooseAllItem = this.chooseItemResult.slice();\r\n      this.chooseItemResult = [];\r\n    }\r\n  }\r\n\r\n  clear(ev: MouseEvent) {\r\n    this.chooseResult = [];\r\n    // 删除了就连原始已经有的默认值也删除\r\n    this.defValue = [];\r\n    // 清除所有\r\n    this.updateValue(this.popValue());\r\n\r\n    if (this.search && this.searchKeyWord) {\r\n      this.searchReset();\r\n      this.searchFocus();\r\n    }\r\n\r\n    ev.stopPropagation();\r\n  }\r\n\r\n  setStatus(val: boolean) {\r\n    this.optStatus = val;\r\n  }\r\n\r\n  searchFocus() {\r\n    const inputElement = this.$refs.input;\r\n    if (inputElement) {\r\n      (inputElement as any).focus();\r\n    }\r\n  }\r\n\r\n  searchblur() {\r\n    const inputElement = this.$refs.input;\r\n    if (inputElement) {\r\n      (inputElement as any).blur();\r\n    }\r\n  }\r\n\r\n  searchChange(searchOption: ReturnParamsEntity, ev: MouseEvent) {\r\n    this.panelChange(searchOption, ev);\r\n    this.searchReset();\r\n  }\r\n\r\n  getSearchResult(result: string[]) {\r\n    this.searchResult = result;\r\n  }\r\n\r\n  searchEnter(ev: MouseEvent) {\r\n    if (this.searchResult.length) {\r\n      const {\r\n        item,\r\n        index,\r\n        floor,\r\n      } = this.searchResult[Math.max(this.searchHoverIndex, 0)];\r\n      const searchResult = this.searchResult[Math.max(this.searchHoverIndex, 0)];\r\n      const value = searchResult[this.fieldNames.value];\r\n      const label = searchResult[this.fieldNames.label] || [];\r\n      const children = searchResult[this.fieldNames.children];\r\n      const changeParams: ReturnParamsEntity = {\r\n        value: label.slice(),\r\n        label,\r\n        current: value[value.length - 1],\r\n        item,\r\n        index,\r\n        floor,\r\n        children,\r\n      };\r\n      this.panelChange(changeParams, ev);\r\n    }\r\n    this.searchReset();\r\n    this.setStatus(false);\r\n    this.searchblur();\r\n  }\r\n\r\n  searchKeyDown() {\r\n    // 递增索引\r\n    this.searchHoverIndex = ++this.searchHoverIndex % this.searchResult.length;\r\n    // 略过不可用\r\n    this.searchHoverIndex = findEnabled(\r\n      this.searchResult,\r\n      this.searchHoverIndex,\r\n      1,\r\n      this.fieldNames,\r\n    );\r\n  }\r\n\r\n  searchKeyUp() {\r\n    // 递减索引\r\n    this.searchHoverIndex = (\r\n      this.searchResult.length + --this.searchHoverIndex\r\n    ) % this.searchResult.length;\r\n    // 略过不可用\r\n    this.searchHoverIndex = findEnabled(\r\n      this.searchResult,\r\n      this.searchHoverIndex,\r\n      -1,\r\n      this.fieldNames,\r\n    );\r\n  }\r\n\r\n  searchReset() {\r\n    this.searchHoverIndex = -1;\r\n    this.searchKeyWord = '';\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  @import \"cascader.scss\";\r\n</style>\r\n"]}]}