{"remainingRequest":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangyufan/em/testPro/vue-scale/src/components/datepicker/DatePicker.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/zhangyufan/em/testPro/vue-scale/src/components/datepicker/DatePicker.vue","mtime":1573474128000},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/css-loader/index.js","mtime":1573721989187},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1574242648574},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/postcss-loader/src/index.js","mtime":1573721998387},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/sass-loader/lib/loader.js","mtime":1574242652692},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/cache-loader/dist/cjs.js","mtime":1573721989004},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js","mtime":1574242648574}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import \"datepicker.scss\";\n",{"version":3,"sources":["DatePicker.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4wBA","file":"DatePicker.vue","sourceRoot":"src/components/datepicker","sourcesContent":["<template>\r\n  <div\r\n    class=\"w-datepicker\"\r\n    v-doc-click=\"bodyClick\"\r\n    ref=\"picker\"\r\n  >\r\n    <div\r\n      @mouseover=\"handleMouseOver\"\r\n      @mouseout=\"handleMouseOut\"\r\n      @click=\"openPicker\"\r\n    >\r\n      <slot v-if=\"$slots.default\"></slot>\r\n      <WInput\r\n        v-model=\"inputValue\"\r\n        :readonly=\"editable\"\r\n        @change=\"inputChange\"\r\n        :disabled=\"disabled\"\r\n        :placeholder=\"placeholder\"\r\n        :size=\"size\"\r\n        v-else\r\n      >\r\n        <WIcon\r\n          slot=\"suffix\"\r\n          aria-label=\"关闭\"\r\n          v-if=\"inputValue\"\r\n        >\r\n          <span\r\n            class=\"w-picker-clear\"\r\n            :class=\"{\r\n              'w-picker-clear-show': clearDisplayStatus,\r\n            }\"\r\n            v-if=\"!disabled && clearable\"\r\n            @click=\"clearValue($event)\"\r\n          >\r\n            <slot name=\"clear\">\r\n              <svg\r\n                viewBox=\"64 64 896 896\"\r\n                focusable=\"false\"\r\n                width=\"1em\"\r\n                fill=\"#B4BAC3\"\r\n                height=\"1em\"\r\n                aria-hidden=\"true\">\r\n                  <path :d=\"pickerSvg.closePath\"></path>\r\n              </svg>\r\n            </slot>\r\n          </span>\r\n          <svg\r\n            viewBox=\"64 64 896 896\"\r\n            focusable=\"false\"\r\n            width=\"1em\"\r\n            :fill=\"clearable && !disabled && clearDisplayStatus ? '#fff': '#B4BAC3'\"\r\n            height=\"1em\"\r\n            aria-hidden=\"true\">\r\n              <path :d=\"pickerSvg.calendarPath\"></path>\r\n          </svg>\r\n        </WIcon>\r\n        <WIcon\r\n          slot=\"suffix\"\r\n          aria-label=\"关闭\"\r\n          v-else\r\n        >\r\n          <svg\r\n            viewBox=\"64 64 896 896\"\r\n            focusable=\"false\"\r\n            width=\"1em\"\r\n            fill=\"#B4BAC3\"\r\n            height=\"1em\"\r\n            aria-hidden=\"true\">\r\n              <path :d=\"pickerSvg.calendarPath\"></path>\r\n          </svg>\r\n        </WIcon>\r\n      </WInput>\r\n    </div>\r\n    <div\r\n      class=\"w-picker\"\r\n      :class=\"pickerClass\"\r\n      v-show=\"pickerStatus\"\r\n      ref=\"popElem\"\r\n      v-transfer-dom=\"getContainer && getContainer()\"\r\n      :data-transfer=\"transfer\"\r\n      @click=\"popoverClick($event)\"\r\n    >\r\n      <i class=\"w-picker-arrow\" :class=\"arrowClass\"></i>\r\n      <div class=\"w-picker-header\">\r\n        <button\r\n          class=\"w-picker-year-prev\"\r\n          @click=\"handlePrevYear\"\r\n        ></button>\r\n        <button\r\n          class=\"w-picker-month-prev\"\r\n          @click=\"handlePrevMonth\"\r\n          v-if=\"isWeekOrDate\"\r\n        ></button>\r\n        <button\r\n          class=\"w-picker-month-next\"\r\n          @click=\"handleNextMonth\"\r\n          v-if=\"isWeekOrDate\"\r\n        ></button>\r\n        <button\r\n          class=\"w-picker-year-next\"\r\n          @click=\"handleNextYear\"\r\n        ></button>\r\n        <span\r\n          v-if=\"tableType === 'age'\"\r\n        >{{ nowRangeAge }}</span>\r\n        <span\r\n          class=\"w-picker-header-text\"\r\n          @click=\"handleAge\"\r\n          v-if=\"tableType === 'year'\"\r\n        >{{ nowRangeYear }}</span>\r\n        <span\r\n          class=\"w-picker-header-text\"\r\n          @click=\"handleYear\"\r\n          v-if=\"tableType === 'date' || tableType === 'month'\"\r\n        >{{ nowYear }}{{ DATE_UNIT_TEXT[0] }}</span>\r\n        <span\r\n          class=\"w-picker-header-text\"\r\n          @click=\"handleMonth\"\r\n          v-if=\"tableType === 'date' || tableType === 'month'\"\r\n        >{{ nowMonth }}{{ DATE_UNIT_TEXT[1] }}</span>\r\n      </div>\r\n      <div class=\"w-picker-body\">\r\n        <DatePcikerTable\r\n          :type=\"tableType\"\r\n          :textValue=\"tableTextValue\"\r\n          :nowValue=\"tableNowValue\"\r\n          :col=\"tableCol\"\r\n          :options=\"tableOptions\"\r\n          :chunkNumber=\"tableChunkNumber\"\r\n          :pickerRender=\"pickerRender\"\r\n          v-model=\"tableValue\"\r\n          @pickerTableChange=\"pickerTableChange\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport moment, { Moment } from 'moment';\r\nimport cloneDeep from 'lodash/cloneDeep';\r\nimport {\r\n  Component,\r\n  Model,\r\n  Prop,\r\n  Emit,\r\n  Watch,\r\n  Vue,\r\n} from 'vue-property-decorator';\r\nimport { mixins } from 'vue-class-component';\r\nimport addDOMEventListener from 'add-dom-event-listener';\r\nimport {\r\n  DateEntity,\r\n  handleMomentObject,\r\n  renderDates,\r\n  formatDateDefault,\r\n  formatDefault,\r\n  valueFormatDateDefault,\r\n  valueFormatDefault,\r\n  WEEK_TEXT,\r\n  MONTH_TEXT,\r\n  DATE_UNIT_TEXT,\r\n  renderYearsByYear,\r\n  renderYearsByRangeYear,\r\n  YearsEntity,\r\n  YearInYearsEntity,\r\n  renderAges,\r\n  AgesEntity,\r\n  AgesInAgesEntity,\r\n  renderMonths,\r\n  MonthInMonthsEntity,\r\n  getRangeYear,\r\n} from '@/helper/date';\r\nimport docClick from '@/directives/doclick';\r\nimport TransferDom from '@/directives/transfer-dom';\r\nimport DatePcikerTable, { PickerTableChangeEntity } from '@/components/datepicker/DatePickerTable.vue';\r\nimport WInput from '@/components/input/Input.vue';\r\nimport WIcon from '@/components/icon/Icon.vue';\r\nimport { pickerSvg, PickerSvgEntity } from '@/helper/pickersvg';\r\nimport { hasOwn } from '@/helper/o';\r\nimport poperMixin from '@/helper/popermixin';\r\nimport { isString, isUndefined } from '@/helper/type';\r\nimport {\r\n  setPostion,\r\n} from '@/helper/poper';\r\nimport { noop } from '@/helper/noop';\r\n\r\nVue.directive('transfer-dom', (TransferDom as any));\r\n\r\nVue.directive('doc-click', (docClick as any));\r\n\r\n@Component({\r\n  components: {\r\n    DatePcikerTable,\r\n    WInput,\r\n    WIcon,\r\n  },\r\n})\r\nexport default class DatePicker extends mixins(poperMixin) {\r\n  pickerSvg: PickerSvgEntity = pickerSvg;\r\n\r\n  inputChangeTimer: number = -1;\r\n\r\n  inputValue: string = '';\r\n\r\n  oldValue: string = ''; // 点击空白处，日期校验失败恢复之前的value\r\n\r\n  updateTable: string | undefined;\r\n\r\n  trueFormat: string = ''; // 显示的格式\r\n\r\n  trueValueFormat: string = ''; // 数据的格式\r\n\r\n  mNowObject: Moment = moment(); // 此刻 moment 的对象\r\n\r\n  mNowJson: DateEntity = this.mNowObject.toObject(); // 此刻 moment 的 json 对象\r\n\r\n  dates: DateEntity[] = [];\r\n\r\n  nowYear: number = 0;\r\n\r\n  nowRangeYear: string = ''; // 年份区间\r\n\r\n  nowRangeAge: string = ''; // 年代区间\r\n\r\n  nowMonth: number = 0;\r\n\r\n  WEEK_TEXT: string[] = WEEK_TEXT;\r\n\r\n  DATE_UNIT_TEXT: string[] = DATE_UNIT_TEXT;\r\n\r\n  MONTH_TEXT: string[] = MONTH_TEXT;\r\n\r\n  particularYears: YearsEntity = {\r\n    years: [],\r\n    range: '',\r\n  };\r\n\r\n  ages: AgesEntity = {\r\n    ages: [],\r\n    range: '',\r\n  };\r\n\r\n  tableCol: string[] = [];\r\n\r\n  tableChunkNumber: number = 0;\r\n\r\n  tableTextValue: string = '';\r\n\r\n  tableNowValue: string = '';\r\n\r\n  tableType: string = 'date';\r\n\r\n  tableValue: string = '';\r\n\r\n  tableOptions: DateEntity[]\r\n    | MonthInMonthsEntity[]\r\n    | AgesInAgesEntity[]\r\n    | YearInYearsEntity[] = [];\r\n\r\n  clearDisplayStatus: boolean = false;\r\n\r\n  pickerStatus: boolean = false;\r\n\r\n  resizeEvent: any = null;\r\n\r\n  @Model('model', { type: String, default: undefined }) readonly value!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: 'date',\r\n  }) private type!: string;\r\n\r\n  @Prop(String) private defaultPickerValue!: string;\r\n\r\n  @Prop(String) private placeholder!: string;\r\n\r\n  @Prop(String) private size!: string;\r\n\r\n  @Prop(String) private format!: string;\r\n\r\n  @Prop(String) private valueFormat!: string;\r\n\r\n  @Prop({\r\n    type: String,\r\n    default: 'bottom', // 不支持左右\r\n  }) private placement!: string;\r\n\r\n  @Prop({\r\n    type: Number,\r\n    default: 8,\r\n  }) private interval!: number;\r\n\r\n  @Prop({\r\n    type: Number,\r\n    default: 0,\r\n  }) private firstDayOfWeek!: number; // 0-6\r\n\r\n  @Prop(Function) private pickerRender!: Function;\r\n\r\n  @Prop(Function) private disabledRender!: Function;\r\n\r\n  @Prop(Function) private getContainer!: Function;\r\n\r\n  @Prop({\r\n    type: Function,\r\n    default: noop,\r\n  }) private change!: Function;\r\n\r\n  @Prop({\r\n    type: Boolean,\r\n    default: true,\r\n  }) private transfer!: boolean;\r\n\r\n  @Prop(Boolean) private editable!: boolean;\r\n\r\n  @Prop(Boolean) private disabled!: boolean;\r\n\r\n  @Prop(Boolean) private open!: boolean;\r\n\r\n  @Prop({\r\n    type: Boolean,\r\n    default: true,\r\n  }) private clearable!: boolean;\r\n\r\n  get isWeekOrDate() {\r\n    return this.type === 'date' || this.type === 'week';\r\n  }\r\n\r\n  get pickerClass(): any[] {\r\n    return [\r\n      {\r\n        'w-picker-horbottom': this.isHorBottom,\r\n        'w-picker-hortop': this.isHorTop,\r\n        'w-picker-horleft': this.isVerLeft,\r\n        'w-picker-horright': this.isVerRight,\r\n      },\r\n    ];\r\n  }\r\n\r\n  get arrowClass(): any[] {\r\n    return [\r\n      {\r\n        'w-picker-arrow-hortop': this.isHorTop,\r\n        'w-picker-arrow-horbottom': this.isHorBottom,\r\n        'w-picker-arrow-verendright': this.isVerEndRight,\r\n        'w-picker-arrow-verendleft': this.isVerEndLeft,\r\n        'w-picker-arrow-vercenter': this.isVerCenter,\r\n      },\r\n    ];\r\n  }\r\n\r\n  created(): void {\r\n    this.initToday();\r\n    this.initFormat();\r\n    // 因为周数的时候需要等待初始化 inputValue\r\n    this.$nextTick(() => {\r\n      this.initPanel();\r\n    });\r\n    this.setPickerStatus();\r\n  }\r\n\r\n  mounted() {\r\n    this.resizeEvent = addDOMEventListener(window, 'resize', this.resizeChange);\r\n    this.resizeChange();\r\n  }\r\n\r\n  beforeDestroy() {\r\n    this.resizeEvent.remove();\r\n  }\r\n\r\n  @Watch('value', {\r\n    immediate: true,\r\n  })\r\n  copyValue() {\r\n    this.oldValue = this.value || this.oldValue;\r\n  }\r\n\r\n  resizeChange() {\r\n    setPostion(this, 'picker');\r\n  }\r\n\r\n  initFormat() {\r\n    if (this.type && !this.format) {\r\n      this.trueFormat = hasOwn(formatDefault, this.type)\r\n        ? (formatDefault as any)[this.type]\r\n        : formatDateDefault;\r\n    } else {\r\n      this.trueFormat = this.format;\r\n    }\r\n\r\n    if (this.type && !this.valueFormat) {\r\n      this.trueValueFormat = hasOwn(valueFormatDefault, this.type)\r\n        ? (valueFormatDefault as any)[this.type]\r\n        : valueFormatDateDefault;\r\n    } else {\r\n      this.trueValueFormat = this.valueFormat;\r\n    }\r\n  }\r\n\r\n  initToday() {\r\n    this.mNowJson = handleMomentObject({\r\n      mObject: this.mNowObject,\r\n      status: 'now',\r\n      format: formatDateDefault,\r\n      valueFormat: formatDateDefault,\r\n    });\r\n    this.setTableNowValue((this.mNowJson.value as string));\r\n  }\r\n\r\n  initPanel() {\r\n    const momentValue = this.inputValue || this.defaultPickerValue;\r\n    const tableMoment = moment(momentValue, momentValue ? this.trueFormat : '');\r\n    this.initTable(tableMoment);\r\n  }\r\n\r\n  // 类型不一样，渲染的面板也不一样\r\n  initTable(tableMoment: moment.Moment) {\r\n    const mValueJson = handleMomentObject({\r\n      mObject: tableMoment,\r\n      status: 'value',\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n    });\r\n    this.nowYear = mValueJson.years;\r\n    this.nowMonth = Number(mValueJson.trueMonths);\r\n\r\n    this.setTableValue((mValueJson.value as string));\r\n\r\n    if (this.isWeekOrDate) {\r\n      this.setTableDate(renderDates({\r\n        mObject: tableMoment,\r\n        firstDayOfWeek: this.firstDayOfWeek,\r\n        format: this.trueFormat,\r\n        valueFormat: this.trueValueFormat,\r\n        disabledRender: this.disabledRender,\r\n      }));\r\n    }\r\n    if (this.type === 'month') {\r\n      this.setTableMonths();\r\n    }\r\n    if (this.type === 'year') {\r\n      this.setTableYearsByYear();\r\n    }\r\n\r\n    if (this.type === 'age') {\r\n      this.nowRangeYear = getRangeYear(this.nowYear).range;\r\n      this.setTableNowValue(this.nowRangeYear);\r\n      this.setTableAges();\r\n    }\r\n  }\r\n\r\n  @Watch('value', {\r\n    immediate: true,\r\n  })\r\n  initInput(value: string) {\r\n    this.$nextTick(() => {\r\n      if (value && isString(value)) {\r\n        // 如果类型是周\r\n        if (this.type === 'week') {\r\n          const dateMoment: string = moment(this.value, this.trueValueFormat)\r\n            .format(formatDateDefault);\r\n          this.inputValue = moment(dateMoment, formatDateDefault).format(this.trueFormat);\r\n        } else {\r\n          this.inputValue = moment(value, this.trueFormat).format(this.trueFormat);\r\n        }\r\n      } else {\r\n        this.inputValue = '';\r\n      }\r\n    });\r\n  }\r\n\r\n  setTableNowValue(value: string) {\r\n    this.tableNowValue = value;\r\n  }\r\n\r\n  setTableValue(value: string) {\r\n    this.tableValue = value;\r\n  }\r\n\r\n  setTableNoTh() {\r\n    this.tableChunkNumber = 3;\r\n    this.tableCol = [];\r\n    this.tableTextValue = 'value';\r\n  }\r\n\r\n  setTableDate(dates: DateEntity[]) {\r\n    this.tableType = this.type;\r\n    this.tableOptions = cloneDeep(dates);\r\n    this.tableChunkNumber = WEEK_TEXT.length;\r\n    this.tableCol = WEEK_TEXT;\r\n    this.tableTextValue = 'trueValue';\r\n  }\r\n\r\n  // 面板设置成月份\r\n  setTableMonths() {\r\n    this.tableType = 'month';\r\n    this.tableOptions = renderMonths({\r\n      year: this.nowYear,\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n      disabledRender: this.disabledRender,\r\n    }).months;\r\n\r\n    this.setTableNoTh();\r\n\r\n    this.tableTextValue = 'inputValue';\r\n    // this.setTableValue(this.value);\r\n  }\r\n\r\n  // 面板设置年份 通过某一年\r\n  setTableYearsByYear() {\r\n    this.tableType = 'year';\r\n    const { years, range } = renderYearsByYear({\r\n      nowYear: this.nowYear,\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n      disabledRender: this.disabledRender,\r\n    });\r\n    this.tableOptions = years;\r\n    this.nowRangeYear = range;\r\n    this.setTableNoTh();\r\n    this.tableTextValue = 'trueValue';\r\n    // this.setTableValue(String(this.nowYear));\r\n  }\r\n\r\n  // 面板设置年份 通过年份区间\r\n  setTableYearsByRangeYear() {\r\n    this.tableType = 'year';\r\n    const [yearStart, yearEnd] = this.nowRangeYear.split('-');\r\n    const { years, range } = renderYearsByRangeYear({\r\n      yearStart: Number(yearStart),\r\n      yearEnd: Number(yearEnd),\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n      disabledRender: this.disabledRender,\r\n    });\r\n\r\n    this.tableOptions = years;\r\n    this.nowRangeYear = range;\r\n    this.setTableNoTh();\r\n    this.tableTextValue = 'trueValue';\r\n  }\r\n\r\n  // 面板设置年代\r\n  setTableAges() {\r\n    this.tableType = 'age';\r\n    const { ages, range } = renderAges({\r\n      range: this.nowRangeYear,\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n      disabledRender: this.disabledRender,\r\n    });\r\n    this.tableOptions = ages;\r\n    this.nowRangeAge = range;\r\n    this.setTableNoTh();\r\n    // this.setTableValue(this.nowRangeYear);\r\n    this.tableTextValue = 'trueValue';\r\n  }\r\n\r\n  pickerTableChange({\r\n    item,\r\n    value,\r\n    type,\r\n    trueValue,\r\n    dateWeek,\r\n    ev,\r\n  }: PickerTableChangeEntity): void {\r\n    if (item.disabled) {\r\n      return;\r\n    }\r\n    // 如果点击的是月份\r\n    if (type === 'month' && this.isWeekOrDate) {\r\n      this.nowMonth = Number(trueValue);\r\n      this.renderTableDateInMonth();\r\n    } else if (type === 'year') { // 如果点击的是年份\r\n      this.nowYear = Number(trueValue);\r\n      if (this.type === 'month') { // 当月份的时候去月份\r\n        this.setTableMonths();\r\n      } else if (this.isWeekOrDate) { // 当日期的时候去日期\r\n        this.renderTableDateInMonth();\r\n      }\r\n    } else if (type === 'age' && this.type !== 'age') { // 如果点击的是年份区间\r\n      this.nowRangeYear = String(trueValue);\r\n      this.setTableYearsByRangeYear();\r\n    }\r\n\r\n    if (!isUndefined(this.value)) {\r\n      const params: PickerTableChangeEntity = {\r\n        type,\r\n        value,\r\n        trueValue,\r\n        item,\r\n        dateWeek,\r\n        ev,\r\n      };\r\n\r\n      this.returnModel(params);\r\n      this.$emit('change', params);\r\n      this.change(params);\r\n\r\n      // 非当前页面自动跳转到当前页面\r\n      this.$nextTick(() => {\r\n        const { status } = item;\r\n        const isPrev = (dateWeek as []).find((weekItem: any) => weekItem.status === 'prev');\r\n        const isNext = (dateWeek as []).find((weekItem: any) => weekItem.status === 'next');\r\n\r\n        if (\r\n          (this.type === 'date' && status === 'next')\r\n          || (this.type === 'week' && isNext)\r\n        ) {\r\n          this.handleNextMonth();\r\n        }\r\n        if (\r\n          (this.type === 'date' && status === 'prev')\r\n          || (this.type === 'week' && isPrev)\r\n        ) {\r\n          this.handlePrevMonth();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  @Emit('model')\r\n  returnModel({ type, value }: PickerTableChangeEntity): string {\r\n    if (this.type === type) {\r\n      this.setTableValue(value);\r\n      this.closePicker();\r\n      return value;\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  renderTableDateInMonth() {\r\n    this.setTableDate(renderDates({\r\n      mObject: moment(`${this.nowYear}-${this.nowMonth}`, this.type === 'week' ? formatDateDefault : this.trueFormat),\r\n      firstDayOfWeek: this.firstDayOfWeek,\r\n      format: this.trueFormat,\r\n      valueFormat: this.trueValueFormat,\r\n      disabledRender: this.disabledRender,\r\n    }));\r\n  }\r\n\r\n  handleMonth() {\r\n    this.setTableValue(`${String(this.nowYear)}-${String(this.nowMonth)}-01`);\r\n    this.setTableMonths();\r\n  }\r\n\r\n  handleYear() {\r\n    this.setTableValue(String(this.nowYear));\r\n    this.setTableYearsByYear();\r\n  }\r\n\r\n  handleAge() {\r\n    this.setTableValue(String(this.nowRangeYear));\r\n    this.setTableAges();\r\n  }\r\n\r\n  handlePrevMonth() {\r\n    this.nowMonth--;\r\n    if (this.nowMonth < 1) {\r\n      this.nowMonth = 12;\r\n      this.nowYear--;\r\n    }\r\n    this.renderTableDateInMonth();\r\n  }\r\n\r\n  handleNextMonth() {\r\n    this.nowMonth++;\r\n    if (this.nowMonth > 12) {\r\n      this.nowMonth = 1;\r\n      this.nowYear++;\r\n    }\r\n    this.renderTableDateInMonth();\r\n  }\r\n\r\n  handleHeaderYear(dirNumber: number) {\r\n    if (this.type === 'month' || this.isWeekOrDate) {\r\n      this.nowYear += 1 * dirNumber;\r\n      if (this.isWeekOrDate) {\r\n        this.renderTableDateInMonth();\r\n      } else {\r\n        this.setTableMonths();\r\n      }\r\n    }\r\n    if (this.type === 'year') {\r\n      this.nowYear += 10 * dirNumber;\r\n      this.setTableYearsByYear();\r\n    }\r\n\r\n    if (this.type === 'age') {\r\n      this.nowYear += 100 * dirNumber;\r\n      this.nowRangeYear = getRangeYear(this.nowYear).range;\r\n      this.setTableAges();\r\n    }\r\n  }\r\n\r\n  handleNextYear() {\r\n    const nextNumber = 1;\r\n    this.handleHeaderYear(nextNumber);\r\n  }\r\n\r\n  handlePrevYear() {\r\n    const prevNumber = -1;\r\n    this.handleHeaderYear(prevNumber);\r\n  }\r\n\r\n  inputChange({ value }: any) {\r\n    clearTimeout(this.inputChangeTimer);\r\n    this.inputChangeTimer = setTimeout(() => {\r\n      const momentValue = value;\r\n      const tableMoment = moment(momentValue, this.trueFormat);\r\n      if (tableMoment.isValid()) {\r\n        this.initInput(value);\r\n        this.initTable(tableMoment);\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  @Emit('model')\r\n  clearValue(ev: Event): string {\r\n    const emptyValue = '';\r\n    this.initInput(emptyValue);\r\n    this.setTableValue(emptyValue);\r\n    this.closePicker();\r\n\r\n    ev.stopPropagation();\r\n\r\n    return emptyValue;\r\n  }\r\n\r\n  handleMouseOver() {\r\n    this.clearDisplayStatus = true;\r\n  }\r\n\r\n  handleMouseOut() {\r\n    this.clearDisplayStatus = false;\r\n  }\r\n\r\n  @Watch('open')\r\n  setPickerStatus() {\r\n    this.pickerStatus = this.open;\r\n  }\r\n\r\n  openPicker() {\r\n    if (!this.disabled) {\r\n      this.pickerStatus = true;\r\n      this.resizeChange();\r\n    }\r\n  }\r\n\r\n  closePicker() {\r\n    this.pickerStatus = false;\r\n  }\r\n\r\n  @Emit('model')\r\n  bodyClick() {\r\n    let newValue = this.value;\r\n    const tableMoment = moment(this.inputValue, this.trueValueFormat);\r\n\r\n    if (tableMoment.isValid()) {\r\n      newValue = tableMoment.format(this.trueValueFormat);\r\n    } else {\r\n      newValue = this.oldValue;\r\n      this.initInput(this.oldValue);\r\n    }\r\n\r\n    this.closePicker();\r\n\r\n    return newValue;\r\n  }\r\n\r\n  popoverClick(ev: Event) {\r\n    ev.stopPropagation();\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  @import \"datepicker.scss\";\r\n</style>\r\n"]}]}