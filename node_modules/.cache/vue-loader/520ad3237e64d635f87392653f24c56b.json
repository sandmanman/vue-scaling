{"remainingRequest":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangyufan/em/testPro/vue-scale/src/components/table/Thead.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/zhangyufan/em/testPro/vue-scale/src/components/table/Thead.vue","mtime":1573474128000},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/cache-loader/dist/cjs.js","mtime":1573721989004},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/babel-loader/lib/index.js","mtime":1574242632071},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/ts-loader/index.js","mtime":1574332289889},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/cache-loader/dist/cjs.js","mtime":1573721989004},{"path":"/Users/zhangyufan/em/testPro/vue-scale/node_modules/vue-loader/lib/index.js","mtime":1574242648574}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport {\r\n  Component,\r\n  Prop,\r\n  Vue,\r\n} from 'vue-property-decorator';\r\nimport WRender from '@/helper/render';\r\nimport { noopArray } from '@/helper/noop';\r\nimport { isFunction, isArray } from '@/helper/type';\r\nimport getValue from '@/helper/getvalue';\r\nimport { hasOwn } from '@/helper/o';\r\n\r\ninterface HeightEnitiy {\r\n  small: number\r\n  default: number\r\n}\r\n\r\n@Component({\r\n  components: {\r\n    WRender,\r\n  },\r\n})\r\nexport default class Thead extends Vue {\r\n  colSort: string[] = [];\r\n\r\n  oldOptions: any[] = [];\r\n\r\n  isFunction: Function = isFunction;\r\n\r\n  getValue: Function = getValue;\r\n\r\n  isArray: Function = isArray;\r\n\r\n  hasOwn: Function = hasOwn;\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private col!: any[];\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private colIndex!: any[];\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private options!: any[];\r\n\r\n  @Prop(Boolean) private border!: boolean;\r\n\r\n  @Prop(Boolean) private showSort!: boolean;\r\n\r\n  @Prop(Boolean) private fixed!: boolean;\r\n\r\n  @Prop(String) private size!: string;\r\n\r\n  height: HeightEnitiy = {\r\n    small: this.border ? 29 : 28,\r\n    default: this.border ? 45 : 44,\r\n  };\r\n\r\n  get lineHeight() {\r\n    return this.border ? 1 : 0;\r\n  }\r\n\r\n  get colGroup() {\r\n    return this.colIndex.length ? this.colIndex : this.col;\r\n  }\r\n\r\n  mounted() {\r\n    this.copyOptions();\r\n    this.sortType();\r\n    this.initSort();\r\n    // 监听父组件的调用\r\n    this.$nextTick(() => {\r\n      this.$on('clearAllSort', () => {\r\n        this.clearAllSort();\r\n      });\r\n    });\r\n  }\r\n\r\n  initSort() {\r\n    const defSortIndex = this.colIndex.findIndex(col => hasOwn(col, 'defaultSortOrder') && !!col.defaultSortOrder && typeof col.defaultSortOrder === 'string');\r\n\r\n    if (defSortIndex > -1) {\r\n      this.sortCol(this.colIndex[defSortIndex], defSortIndex);\r\n    }\r\n  }\r\n\r\n  copyOptions() {\r\n    this.oldOptions = this.options.slice();\r\n  }\r\n\r\n  sortCol(colItem: any, colIndex: number, ev?: MouseEvent) {\r\n    // 重置其他筛选\r\n    this.sortType(colIndex);\r\n    // 如果限制条件\r\n    const { sortDirections = [] } = colItem;\r\n    if (this.colSort[colIndex] === 'all') {\r\n      const descend = sortDirections.indexOf('descend') > -1;\r\n      if (isFunction(colItem.sorter)) {\r\n        this.options = this.options.sort(colItem.sorter);\r\n      }\r\n      this.colSort.splice(colIndex, 1, descend ? 'descend' : 'ascend');\r\n    } else if (this.colSort[colIndex] === 'ascend') {\r\n      if (isFunction(colItem.sorter)) {\r\n        this.options = this.options.sort(colItem.sorter);\r\n        this.options.reverse();\r\n      }\r\n      this.colSort.splice(colIndex, 1, 'descend');\r\n    } else {\r\n      this.clearSort(colItem, colIndex);\r\n    }\r\n\r\n    if ((colItem.sorter || this.showSort) && ev) {\r\n      this.$emit('change', {\r\n        col: colItem,\r\n        colIndex,\r\n        sortType: this.colSort[colIndex],\r\n        ev,\r\n      });\r\n    }\r\n  }\r\n\r\n  clearAllSort() {\r\n    this.colIndex.forEach((colItem: any, colIndex: number) => {\r\n      this.clearSort(colItem, colIndex);\r\n    });\r\n  }\r\n\r\n  clearSort(colItem: any, colIndex: number) {\r\n    if (isFunction(colItem.sorter)) {\r\n      this.resetData();\r\n    }\r\n    this.colSort.splice(colIndex, 1, 'all');\r\n  }\r\n\r\n  resetData() {\r\n    let oldIdx = 0;\r\n    while (this.options.length) {\r\n      this.options.pop();\r\n    }\r\n    while (oldIdx < this.oldOptions.length) {\r\n      this.options.push(this.oldOptions[oldIdx]);\r\n      oldIdx++;\r\n    }\r\n  }\r\n\r\n  // 设置筛选切换\r\n  sortType(ignoreIndex = -1) {\r\n    this.colSort = this.colIndex.map((col, colIndex) => (ignoreIndex === colIndex ? this.colSort[colIndex] : 'all'));\r\n  }\r\n}\r\n",{"version":3,"sources":["Thead.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Thead.vue","sourceRoot":"src/components/table","sourcesContent":["<template>\r\n  <table\r\n    class=\"w-table\"\r\n    :class=\"{\r\n      ['w-table-border']: border,\r\n    }\"\r\n  >\r\n    <colgroup>\r\n      <col\r\n        :key=\"colIdx\"\r\n        v-for=\"\r\n        (colItem, colIdx) in colGroup\"\r\n        :style=\"{ width: getValue(colItem.width), minWidth: getValue(colItem.width) }\"\r\n      >\r\n    </colgroup>\r\n    <thead class=\"w-table-thead\">\r\n      <tr\r\n        class=\"w-table-tr\"\r\n        v-for=\"( colLine, colLineIndex ) in col\"\r\n        :key=\"colLineIndex\"\r\n      >\r\n        <template\r\n          v-for=\"( colItem, colIndex ) in colLine\"\r\n        >\r\n          <th\r\n            :key=\"colIndex\"\r\n            class=\"w-table-th\"\r\n            :class=\"{\r\n              ['w-table-sorter']: isFunction(colItem.sorter),\r\n              ['w-table-sortered']: isFunction(colItem.sorter) && colSort[colIndex] !== 'all',\r\n              ['w-table-border-th']: border,\r\n              [`w-table-th-${size}`]: size,\r\n            }\"\r\n            :style=\"{\r\n              height: colItem.rowSpan > 1 && fixed\r\n                ? `${colItem.rowSpan * height[size || 'default'] - lineHeight}px`\r\n                : 'auto',\r\n              textAlign: colItem.rowSpan > 0 ? 'left' : 'center'\r\n            }\"\r\n            :rowspan=\"colItem.rowSpan\"\r\n            :colspan=\"colItem.colSpan\"\r\n            @click=\"sortCol(colItem, colIndex, $event)\"\r\n            v-if=\"!hasOwn(colItem, 'colSpan') || colItem.colSpan > 0\"\r\n          >\r\n            <span\r\n              class=\"w-table-th-title\"\r\n              v-if=\"colItem.title\"\r\n            >{{ colItem.title }}</span>\r\n            <slot\r\n              :optItem=\"options[colIndex]\"\r\n              :colItem=\"colItem\"\r\n              :optIndex=\"colIndex\"\r\n              :options=\"options\"\r\n              :name=\"`header-${colItem.dataIndex}`\"\r\n              v-else-if=\"$scopedSlots[`header-${colItem.dataIndex}`]\"\r\n            ></slot>\r\n            <w-render\r\n              :render=\"colItem.headRender\"\r\n              v-if=\"isFunction(colItem.headRender)\"\r\n              :data=\"{\r\n                colItem,\r\n                colIndex,\r\n              }\"\r\n            ></w-render>\r\n            <div class=\"w-table-sort\" v-if=\"showSort || hasOwn(colItem, 'sorter')\">\r\n              <i\r\n                class=\"w-table-sort-icon w-table-sort-up\"\r\n                :class=\"{\r\n                  ['w-table-sort-on']: colSort[colIndex] === 'ascend',\r\n                }\"\r\n                v-if=\"\r\n                !hasOwn(colItem, 'sortDirections')\r\n                || (\r\n                    hasOwn(colItem, 'sortDirections')\r\n                    && isArray(colItem.sortDirections)\r\n                    && colItem.sortDirections.indexOf('ascend') > -1\r\n                  )\"\r\n              ></i>\r\n              <i\r\n                class=\"w-table-sort-icon w-table-sort-down\"\r\n                :class=\"{\r\n                  ['w-table-sort-on']: colSort[colIndex] === 'descend',\r\n                }\"\r\n                v-if=\"\r\n                !hasOwn(colItem, 'sortDirections')\r\n                || (\r\n                  hasOwn(colItem, 'sortDirections')\r\n                  && isArray(colItem.sortDirections)\r\n                  && colItem.sortDirections.indexOf('descend') > -1\r\n                )\"\r\n              ></i>\r\n            </div>\r\n          </th>\r\n        </template>\r\n      </tr>\r\n    </thead>\r\n  </table>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport {\r\n  Component,\r\n  Prop,\r\n  Vue,\r\n} from 'vue-property-decorator';\r\nimport WRender from '@/helper/render';\r\nimport { noopArray } from '@/helper/noop';\r\nimport { isFunction, isArray } from '@/helper/type';\r\nimport getValue from '@/helper/getvalue';\r\nimport { hasOwn } from '@/helper/o';\r\n\r\ninterface HeightEnitiy {\r\n  small: number\r\n  default: number\r\n}\r\n\r\n@Component({\r\n  components: {\r\n    WRender,\r\n  },\r\n})\r\nexport default class Thead extends Vue {\r\n  colSort: string[] = [];\r\n\r\n  oldOptions: any[] = [];\r\n\r\n  isFunction: Function = isFunction;\r\n\r\n  getValue: Function = getValue;\r\n\r\n  isArray: Function = isArray;\r\n\r\n  hasOwn: Function = hasOwn;\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private col!: any[];\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private colIndex!: any[];\r\n\r\n  @Prop({\r\n    type: Array,\r\n    default: noopArray,\r\n  }) private options!: any[];\r\n\r\n  @Prop(Boolean) private border!: boolean;\r\n\r\n  @Prop(Boolean) private showSort!: boolean;\r\n\r\n  @Prop(Boolean) private fixed!: boolean;\r\n\r\n  @Prop(String) private size!: string;\r\n\r\n  height: HeightEnitiy = {\r\n    small: this.border ? 29 : 28,\r\n    default: this.border ? 45 : 44,\r\n  };\r\n\r\n  get lineHeight() {\r\n    return this.border ? 1 : 0;\r\n  }\r\n\r\n  get colGroup() {\r\n    return this.colIndex.length ? this.colIndex : this.col;\r\n  }\r\n\r\n  mounted() {\r\n    this.copyOptions();\r\n    this.sortType();\r\n    this.initSort();\r\n    // 监听父组件的调用\r\n    this.$nextTick(() => {\r\n      this.$on('clearAllSort', () => {\r\n        this.clearAllSort();\r\n      });\r\n    });\r\n  }\r\n\r\n  initSort() {\r\n    const defSortIndex = this.colIndex.findIndex(col => hasOwn(col, 'defaultSortOrder') && !!col.defaultSortOrder && typeof col.defaultSortOrder === 'string');\r\n\r\n    if (defSortIndex > -1) {\r\n      this.sortCol(this.colIndex[defSortIndex], defSortIndex);\r\n    }\r\n  }\r\n\r\n  copyOptions() {\r\n    this.oldOptions = this.options.slice();\r\n  }\r\n\r\n  sortCol(colItem: any, colIndex: number, ev?: MouseEvent) {\r\n    // 重置其他筛选\r\n    this.sortType(colIndex);\r\n    // 如果限制条件\r\n    const { sortDirections = [] } = colItem;\r\n    if (this.colSort[colIndex] === 'all') {\r\n      const descend = sortDirections.indexOf('descend') > -1;\r\n      if (isFunction(colItem.sorter)) {\r\n        this.options = this.options.sort(colItem.sorter);\r\n      }\r\n      this.colSort.splice(colIndex, 1, descend ? 'descend' : 'ascend');\r\n    } else if (this.colSort[colIndex] === 'ascend') {\r\n      if (isFunction(colItem.sorter)) {\r\n        this.options = this.options.sort(colItem.sorter);\r\n        this.options.reverse();\r\n      }\r\n      this.colSort.splice(colIndex, 1, 'descend');\r\n    } else {\r\n      this.clearSort(colItem, colIndex);\r\n    }\r\n\r\n    if ((colItem.sorter || this.showSort) && ev) {\r\n      this.$emit('change', {\r\n        col: colItem,\r\n        colIndex,\r\n        sortType: this.colSort[colIndex],\r\n        ev,\r\n      });\r\n    }\r\n  }\r\n\r\n  clearAllSort() {\r\n    this.colIndex.forEach((colItem: any, colIndex: number) => {\r\n      this.clearSort(colItem, colIndex);\r\n    });\r\n  }\r\n\r\n  clearSort(colItem: any, colIndex: number) {\r\n    if (isFunction(colItem.sorter)) {\r\n      this.resetData();\r\n    }\r\n    this.colSort.splice(colIndex, 1, 'all');\r\n  }\r\n\r\n  resetData() {\r\n    let oldIdx = 0;\r\n    while (this.options.length) {\r\n      this.options.pop();\r\n    }\r\n    while (oldIdx < this.oldOptions.length) {\r\n      this.options.push(this.oldOptions[oldIdx]);\r\n      oldIdx++;\r\n    }\r\n  }\r\n\r\n  // 设置筛选切换\r\n  sortType(ignoreIndex = -1) {\r\n    this.colSort = this.colIndex.map((col, colIndex) => (ignoreIndex === colIndex ? this.colSort[colIndex] : 'all'));\r\n  }\r\n}\r\n</script>\r\n"]}]}